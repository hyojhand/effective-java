# 아이템8. finalizer와 cleaner 사용을 피하라

### 자바에서 제공하는 객체 소멸자 finalizer, cleaner

- finalizer와 cleaner는 즉시 수행된다는 보장이 없어 예측할 수 없다.
- finalizer와 cleaner는 실행되지 않을 수도 있다.

finalizer 내부에 있는 큐를 처리하는 스레드의 우선순위가 더 낮기 때문에 리소스 반납이 전혀 안될 수 있다.  
즉, 제때 실행되어야 하는 작업은 절대 할 수 없다.

cleaner에서는 절대로 처리할 인스턴스를 참조하면 안된다.  
회수할 인스턴스를 참조할 경우 순환 참조가 생겨 GC가 그 인스턴스를 다시 참조하게 되면서 회수할 기회가 오지않는다.

- finalizer 동작 중에 발생한 예외는 무시되며, 처리할 작업이 남아도 그 순간 종료된다.
- finalizer와 cleaner는 심각한 성능 문제가 있다.
- finalizer는 finalizer 공격에 노출되어 심각한 보안 문제가 생길 수 있다.

### 해결 방법

AutoCloseable을 구현해서 close() 메서드를 호출한다.  
또한, 예외가 발생해도 제대로 종료되도록 try-with-resource를 사용하여 자원을 다 쓰고나서 정리하도록 한다.

### 그럼에도 cleaner와 finalizer의 쓰임새

1. 자원의 소유자가 close 메서드를 호출하지 않는 것을 대비하여,  
GC가 일어날 때 자원을 반납할 기회를 가질 수 있도록 “안전망”으로 사용한다.
2. 네이티브 피어(native peer)와 연결된 객체는 자바 객체가 아니니 GC가 그 존재를 알지 못한다.  
따라서 이러한 객체를 처리할 때 사용할 수 있겠다.